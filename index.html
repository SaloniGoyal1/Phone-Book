<html>
<head>
<title>Phone Book</title>
<script src="https://kit.fontawesome.com/a076d05399.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
var contactList =[];
var time=[];
$(document).ready(function(){
    $.get("https://phone-web.herokuapp.com//fetchAllContacts",
	function(data, status){
        console.log("Data: " + data + "\nStatus: " + status);
		time=data;
		copyList();
		$('.contact').remove();
		for(var i=0;i<contactList.length;i++)
			$('#list').append(createNode(contactList[i]));  
	});
});
function edditedList(){
	$('.contact').remove();
	for(var i=0;i<contactList.length;i++)
		$('#list').append(createNode(contactList[i])); 
}
	
function createNode(contact){
	var x= `<div class="contact" onclick='expand(this)' style="position:relative;">
	<p style="text-align:center;"> `+ contact.name+` </p>`+ returnNumber(contact) + returnEmail(contact) +`
	<a onclick="expand(this)" class='createnode' style="position:absolute; z-index:10; top:5px; right:18px; " ><i class="fas fa-sort-down" style="font-size: 30px; "></i></a>
	</div>`;
    return x;
}

function returnNumber(data){
	var phone=data.number.split(':');
	var str="<span style='margin-left:20px; display:inline; text-align:center; width:175px; overflow:auto; float:left; '>";
	for(var i=0;i<phone.length;i++)
	    str+="<i class='fas fa-phone' style='font-size: 18px;'></i> "+ phone[i]+"<br> ";
	str+='</span>';
	return str;
}

function returnEmail(data){
	var phone=data.email.split(':');
	var str="<span style='padding-top:0px; display:inline; text-align:right; width:175px; overflow:none; float:right; margin-right:20px;'>";
	for(var i=0;i<phone.length;i++)
		str+="<i class='fas fa-envelope-open-text' style='font-size: 15px;'></i>"+phone[i]+"<br>"
	str+='</span>';
	return str;
}
	
function serach(obj){
	console.log('Number Called');
	var str=obj.value;
	copyList();
	for(var i=0;i<contactList.length;i++){
		if(contactList[i].name.includes(str) || contactList[i].number.includes(str) || contactList[i].email.includes(str)){}
		else{
			console.log(i);
			if (i > -1) {
				contactList.splice(i, 1);
				i--;
			}
		}
	}
	edditedList();
};

function copyList(){
	contactList=[];
	for(var i=0;i<time.length;i++){
		contactList.push(time[i]);
	}
}
    
function expand(x){
	if($(x).css('height')=='50px'){
		$('.contact').animate({height: '50px'}, { duration: 200, queue: false });
		$('.contact').css({background: 'cream'});
		$(x).animate({height: '150px'}, { duration: 200, queue: false });
		$(x).css({background: ' rgb(166, 247, 243)'});
		$('.createnode').css({background: ' rgba(0, 0, 0,0)'});
	}
	else{
		$(x).animate({height: '50px'}, { duration: 200, queue: false });
		$('.createnode').css({background: ' rgba(0, 0, 0,0)'});
		$('.contact').css({background: 'cream'});
	}		
}
</script>
</head>
<body>
    <center><div style="width: 500px; height: auto; border: 1px solid black; margin: 50px;" class="div1">
        <h1 style="margin: 0px; padding: 0px; background-color: aqua;">Phone Book</h1>
        <form>
            <input type="search" placeholder="Search" style="width: 400px; height: 40px; font-size: 20px; margin: 40px;" class="search" onKeyUp="serach(this)">
            <div style="height: 300px; width: 420px; border: 1px solid black; overflow-y: scroll; overflow-x:auto;" class="contacts" id='list'>
            </div>
            <a href="addcontact.html"><i class="fas fa-plus-circle" style="margin-top: 40px; font-size: 50px;"></i></a>
        </form>
    </div></center>
</body>
</html>